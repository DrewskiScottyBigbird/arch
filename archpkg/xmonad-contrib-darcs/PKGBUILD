# Contributor: Adam Vogt <vogt.adam@gmail.com>
pkgname=xmonad-contrib-darcs
pkgver=20090909
pkgrel=1
pkgdesc="Community Contributed modules for xmonad"
arch=('i686' 'x86_64')
url="http://xmonad.org/"
license=('custom:BSD3')
depends=('xmonad-darcs' 'haskell-x11-xft' 'haskell-utf8-string')
makedepends=('ghc' 'darcs')
provides=()
conflicts=('xmonad-contrib')
replaces=()
backup=()
install=hsmod.install
source=()
md5sums=()

_darcsmod="XMonadContrib"
_darcstrunk="http://code.haskell.org"

build() {
  msg
  msg "If build fails, update your xmonad-darcs and haskell-x11"
  msg
  cd $startdir/src/
  if [[ -d $startdir/src/$_darcsmod/_darcs ]]
  then
    msg "Retrieving missing patches"
    cd $_darcsmod
    darcs pull -a $_darcstrunk/$_darcsmod
  else
    msg "Retrieving complete sources"
    darcs get --partial --set-scripts-executable $_darcstrunk/$_darcsmod
	cd $_darcsmod
  fi

  runhaskell Setup.lhs configure --ghc --prefix=/usr --flags="use_xft" \
             --libsubdir=\$compiler/site-local/\$pkgid || return 1

  runhaskell Setup.lhs build || return 1

  runhaskell Setup.lhs register --gen-script
  runhaskell Setup.lhs unregister --gen-script

  install -D -m744 register.sh $startdir/pkg/usr/share/haskell/$pkgname/register.sh
  install -m744 unregister.sh $startdir/pkg/usr/share/haskell/$pkgname/unregister.sh

  runhaskell Setup.lhs copy --destdir=$startdir/pkg

  install -D -m644 LICENSE $startdir/pkg/usr/share/licenses/XmonadContrib/BSD3
}
