# Contributor: Sylvester Johansson <scj(at)archlinux(dot)us>
pkgname=ocaml-zip
pkgver=1.03
pkgrel=3
pkgdesc="zip and gzip library for ocaml"
arch=('i686' 'x86_64')
url="http://cristal.inria.fr/~xleroy/software.html#camlzip"
license=('GPL')
depends=('ocaml' 'zlib' 'ocaml-findlib>=1.2.3')
install=camlzip.install
source=(http://caml.inria.fr/distrib/bazar-ocaml/camlzip-$pkgver.tar.gz
        http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/dev-ml/camlzip/files/camlzip-$pkgver-Makefile-findlib.patch?rev=1.2
        http://sources.gentoo.org/viewcvs.py/*checkout*/gentoo-x86/dev-ml/camlzip/files/META)
noextract=()
md5sums=('65cee9abf1df6544cae554b94128d441'
         '0e0f9c6860c23f4efef72563969188dd'
         '357f403e3152810089ea2f7bb86bf77d')
options=(!strip)

build() {

  cd "$srcdir/camlzip-$pkgver"

  cp ../camlzip-$pkgver-Makefile-findlib.patch?rev=1.2 makefile.patch
  sed -ie 's|$(OCAMLFIND) install camlzip|$(OCAMLFIND) install $(OCAMLFIND_INSTFLAGS) zip|' makefile.patch || return 1
  patch -i makefile.patch || return 1
  mkdir -p $pkgdir$(ocamlfind printconf destdir)
  ln -s $startdir/META META
  sed -ie 's|version=.*|version="'$pkgver'"|' META || return 1

  make all allopt || return 1
  make OCAMLFIND_INSTFLAGS="-destdir $pkgdir$(ocamlfind printconf destdir) -ldconf ignore" install || return 1
  install -Dm 644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
  
}

# vim:set ts=2 sw=2 et:
